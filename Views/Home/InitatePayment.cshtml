
@{
    ViewData["Title"] = "Initate Payment";
}



<script src="~/js/azure-storage.blob.js" type="text/javascript"></script>
<script src="~/js/app.js"></script>
<script src="~/js/site.js"></script>
<script src="~/js/Spin.js"></script>


<div class="col-lg-12">
    <div class="col-lg-1">
    </div>
    <div class="col-lg-10" id="bodyIdAttachment">
        <form asp-area="" asp-controller="Home" asp-action="InitatePayments" method="get">
            <div id="spinnerattachment">
            </div>
            <input type="hidden" name="UserId" id="UserId" value="@ViewBag.UserId" />
            <input type="" name="FileName" id="FileName"  />

            <input type="hidden" id="sasToken" value="@ViewBag.sasToken" name="sasToken" />

            <label>Upload File</label>
            <br>
            <input onchange="ReceiverFileSelected1('File1','scannedIdbtn')" id="File1" type="file" class="" />
            <input type="hidden" id="FileOrg" name="FileOrg" class="" />
            <br>
            <input type="button" id="scannedIdbtn" disabled class="btn btn-primary" onclick="uploadAttachment1('File1','FileOrg','submitbtn');" value="Upload " />
            <br>

            <br>
            <label>Comments:</label>
            <br>

            <textarea type="text" class="form-control" style="height:100px" required name="Comments" value="" >  </textarea>
            <br>

            <button type="submit" id="submitbtn" disabled class="btn btn-success">Make Payment</button>
            <br>

        </form>


    </div>

</div>




<script>
    function ReceiverFileSelected1(fileInputId, buttonId) {
        if ($("#" + fileInputId).val != "") {
            document.getElementById(buttonId).disabled = false;
        }
    }

    function uploadAttachment1(File1, attachment, buttonId) {
        //document.getElementById(attachment1).disabled = true;

        var blobUri = "https://mtamadev.blob.core.windows.net/";
        var sas = document.getElementById("sasToken").value;
        var container = "payments";

        var file = document.getElementById(File1).files[0];

        document.getElementById("FileName").value = file.name;

        if (file == null || file == undefined) {
            alert("Please choose a file to upload.");
            return;
        }

        showSpinnerAttachment1();
        var transactionId = file.name;
        var fileurl = blobUri + container + '/' + transactionId;
        var blobService = AzureStorage.Blob.createBlobServiceWithSas(blobUri, sas);

        //use block sizes of 4MB for file sizes > 32 MB. otherwise 512KB
        var customBlockSize = file.size > 1024 * 1024 * 32 ? 1024 * 1024 * 4 : 1024 * 512;
        blobService.singleBlobPutThresholdInBytes = customBlockSize;

        var finishedOrError = false;
        blobService.createBlockBlobFromBrowserFile(container, transactionId, file, { blockSize: customBlockSize }, function (error, result, response) {
            finishedOrError = true;
            if (error) {
                // Upload blob failed
                alert("Upload Failed. Please reload the page. ");
                // alert(error);

            } else {
                // Upload successfully
                document.getElementById(attachment).value = fileurl + sas;
                $('#spinnerattachment').hide();

                $("#bodyIdAttachment").addClass("enablebutton");

                document.getElementById(buttonId).disabled = false;

            }
        });


    }


    function showSpinnerAttachment1() {

        //$("#bodyIdAttachment").addClass("disabledbutton");

        let opts = {
            lines: 13,
            length: 28,
            width: 14,
            radius: 42,
            scale: 1,
            corners: 1,
            color: 'black',
            opacity: 0.25,
            rotate: 0,
            direction: 1,
            speed: 1,
            trail: 60,
            fps: 20,
            zIndex: 2e9,
            className: 'spinner',
            top: '50%',
            left: '50%',
            shadow: false,
            hwaccel: false,
            position: 'fixed',
        },
            target = document.getElementById('spinnerattachment'),
            spinner = new Spinner(opts).spin(target);

    }



</script>

